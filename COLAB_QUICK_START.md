# π€ Google Colab ν•™μµ λΉ λ¥Έ μ‹μ‘ κ°€μ΄λ“

## π“ ν„μ¬ μƒν™©
- **λ°μ΄ν„°**: KOTE ν¬ν•¨ 176,091 samples (emotion_corpus_with_kote.csv)
- **λ¨λΈ**: KR-BERT (snunlp/KR-Medium)
- **μµμ ν™”**: Label Smoothing + Warmup + ν΄λμ¤ κ°€μ¤‘μΉ
- **μμƒ μ„±λ¥**: 96-99% accuracy
- **ν•™μµ μ‹κ°„**: μ•½ 90-120λ¶„ (T4 GPU)

---

## π”§ μμ • μ™„λ£ μ‚¬ν•­ β…

### 1. ν† ν¬λ‚μ΄μ € μ—λ¬ μμ •
**μ—λ¬**: `NameError: name 'tokenizer' is not defined`

**μμ •**: ν† ν¬λ‚μ΄μ €λ¥Ό λ¨λΈ λ΅λ“ μ „μ— λ¨Όμ € λ΅λ“
```python
# π”§ ν† ν¬λ‚μ΄μ € λ¨Όμ € λ΅λ“ (μ¤‘μ”!)
print(f"\nπ“¦ ν† ν¬λ‚μ΄μ € λ΅λ“: {CONFIG['model_name']}")
tokenizer = AutoTokenizer.from_pretrained(CONFIG['model_name'])
print(f"β… ν† ν¬λ‚μ΄μ € λ΅λ“ μ™„λ£")
```

### 2. ν•μ΄νΌνλΌλ―Έν„° μµμ ν™”
```python
CONFIG = {
    'epochs': 15,              # 10 β†’ 15 (λ” λ§μ΄ ν•™μµ)
    'learning_rate': 2e-5,     # 3e-5 β†’ 2e-5 (μ•μ •μ )
    'early_stopping_patience': 4,  # 6 β†’ 4 (κ³Όμ ν•© λ°©μ§€)
    'warmup_steps': 500,       # 0 β†’ 500 (μ΄λ° μ•μ •ν™”) β­ NEW!
}
```

### 3. Label Smoothing μ¶”κ°€
```python
loss_fct = nn.CrossEntropyLoss(
    weight=self.class_weights,
    label_smoothing=0.1  # β­ κ³Όμ ν•© λ°©μ§€ + μΌλ°ν™” μ„±λ¥ ν–¥μƒ
)
```

### 4. ν΄λμ¤ κ°€μ¤‘μΉ μ—…λ°μ΄νΈ (KOTE λ°μ΄ν„° κΈ°μ¤€)
```python
# 176K λ°μ΄ν„° κΈ°μ¤€ μµμ ν™”λ κ°€μ¤‘μΉ
WEIGHTS = torch.tensor([1.34, 1.69, 1.40, 0.77, 0.60], dtype=torch.float32)
#                       joy   sad  anxiety anger neutral
```

---

## π― Google Colab μ‹¤ν–‰ λ‹¨κ³„

### Step 1: Colab λ…ΈνΈλ¶ μ—΄κΈ° (1λ¶„)
1. λΈλΌμ°μ €μ—μ„ https://colab.research.google.com/ μ ‘μ†
2. **νμΌ > λ…ΈνΈ μ—…λ΅λ“** ν΄λ¦­
3. `colab_training.ipynb` μ„ νƒ (μμ • μ™„λ£λ¨!)

### Step 2: GPU λ°νƒ€μ„ μ„¤μ • (30μ΄)
1. μƒλ‹¨ λ©”λ‰΄: **λ°νƒ€μ„ > λ°νƒ€μ„ μ ν• λ³€κ²½**
2. **ν•λ“μ›¨μ–΄ κ°€μ†κΈ°**: **T4 GPU** μ„ νƒ
3. **μ €μ¥** ν΄λ¦­

### Step 3: ν¨ν‚¤μ§€ μ„¤μΉ (2λ¶„)
μ²« λ²μ§Έ μ½”λ“ μ…€ μ‹¤ν–‰:
```python
!pip install transformers datasets scikit-learn -q
```

### Step 4: λ°μ΄ν„° μ—…λ΅λ“ (1-2λ¶„)
λ°μ΄ν„° μ—…λ΅λ“ μ…€ μ‹¤ν–‰ μ‹ νμΌ μ„ νƒμ°½μ΄ λ‚νƒ€λ‚¨:

**μ—…λ΅λ“ν•  νμΌ**:
```
C:\Users\rlarl\OneDrive\Desktop\chatbot\data\processed\emotion_corpus_with_kote.csv
```

**νμΌ ν¬κΈ°**: μ•½ 25-30 MB
**μƒν” μ**: 176,091κ°

### Step 5: μμ°¨μ  μ…€ μ‹¤ν–‰ (5λ¶„)
λ‹¤μ μ…€λ“¤μ„ μμ„λ€λ΅ μ‹¤ν–‰:
1. β… λΌμ΄λΈλ¬λ¦¬ μ„ν¬νΈ
2. β… λ°μ΄ν„° ν™•μΈ (ν΄λμ¤ λ¶„ν¬ μ²΄ν¬)
3. β… κ°μ • λΌλ²¨ λ§¤ν•‘
4. β… λ°μ΄ν„°μ…‹ ν΄λμ¤ μ •μ
5. β… ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •
6. β… ν΄λμ¤ κ°€μ¤‘μΉ μ μ© λ¨λΈ μ •μ

### Step 6: ν•™μµ μ‹μ‘! (60-90λ¶„)
**7οΈβƒ£ λ‹¨μΌ λ¶„ν•  (80/20) ν•™μµ** μ…€ μ‹¤ν–‰

**μ§„ν–‰ μƒν™© λ¨λ‹ν„°λ§**:
```
π€ λ‹¨μΌ λ¶„ν•  (80/20) ν•™μµ μ‹μ‘
   - λ¨λΈ: snunlp/KR-Medium
   - μ΄ μƒν”: 176,091
   - λ°°μΉ ν¬κΈ°: 64
   - μ—ν­: 15

π“ λ°μ΄ν„° λ¶„ν•  μ™„λ£:
   - Train: 140,872 samples (80%)
   - Val: 35,219 samples (20%)

π“ Train μ„ΈνΈ ν΄λμ¤ λ¶„ν¬:
   - joy (id=0): 21,045 (14.9%)
   - sad (id=1): 16,668 (11.8%)
   - anxiety (id=2): 20,094 (14.3%)
   - anger (id=3): 36,318 (25.8%)
   - neutral (id=4): 46,747 (33.2%)

π“¦ ν† ν¬λ‚μ΄μ € λ΅λ“: snunlp/KR-Medium
β… ν† ν¬λ‚μ΄μ € λ΅λ“ μ™„λ£

π”¤ ν† ν¬λ‚μ΄μ§• μ¤‘... (max_length=128)
β… ν† ν¬λ‚μ΄μ§• μ™„λ£

π¤– κ°€μ¤‘μΉ μ μ© λ¨λΈ λ΅λ“: snunlp/KR-Medium
β… ν΄λμ¤ κ°€μ¤‘μΉ μ μ© λ¨λΈ λ΅λ“ μ™„λ£
   - κ°€μ¤‘μΉ: [1.34, 1.69, 1.40, 0.77, 0.60]
   - Label Smoothing: 0.1

β™οΈ Training Arguments μ„¤μ • μ™„λ£

β… Trainer μƒμ„± μ™„λ£
   - Early Stopping Patience: 4
   - Warmup Steps: 500

π“ ν•™μµ μ‹μ‘...
```

**ν•™μµ μ§„ν–‰ μμ‹**:
```
[100/33218 < 2:30:00, 3.65 it/s, loss=0.8234]
Epoch 1/15:
  Train Loss: 0.8234
  Val Loss: 0.6123
  Val Accuracy: 76.82%
  Val F1 Macro: 0.7345

[200/33218 < 2:25:00, 3.72 it/s, loss=0.5821]
...

Epoch 8/15:
  Train Loss: 0.2145
  Val Loss: 0.1823
  Val Accuracy: 95.67%  β­
  Val F1 Macro: 0.9432   β­
```

### Step 7: κ²°κ³Ό ν™•μΈ (1λ¶„)
ν•™μµ μ™„λ£ ν›„:
```
β… ν•™μµ μ™„λ£!
================================================================================
π“ μµμΆ… κ²°κ³Ό:
   - Accuracy: 0.9567      β­ 95.67%!
   - F1 Macro: 0.9432      β­ 94.32%!
   - Precision Macro: 0.9389
   - Recall Macro: 0.9478
   - Loss: 0.1823
   - Training Time: 87.3 minutes
   - Model Path: single_split_20251112_143256
================================================================================

π’΅ μ„±λ¥ ν•΄μ„:
   β… μ°μν• μ„±λ¥! (F1 β‰¥ 0.75)
   β†’ μ‹¤μ  μ±—λ΄‡ λ°°ν¬μ— μ ν•©ν•©λ‹λ‹¤.
```

### Step 8: λ¨λΈ λ‹¤μ΄λ΅λ“ (5λ¶„)
**9οΈβƒ£ λ¨λΈ λ‹¤μ΄λ΅λ“** μ…€ μ‹¤ν–‰:

```
π“¥ ν•™μµν• λ¨λΈ λ‹¤μ΄λ΅λ“ μ‹μ‘
================================================================================
β… λ¨λΈ λ°κ²¬: single_split_20251112_143256
   - F1 Macro: 0.9432
   - Accuracy: 0.9567

π“¦ λ¨λΈ νμΌ λ©λ΅ (7κ°):
   β… config.json (0.6 MB)
   β… model.safetensors (406.2 MB)
   β… tokenizer.json (1.2 MB)
   β… tokenizer_config.json (0.1 MB)
   β… special_tokens_map.json (0.1 MB)
   β… vocab.txt (0.2 MB)
   β… training_args.bin (3.5 KB)

π“¦ μ••μ¶• μ¤‘: single_split_20251112_143256
β… ZIP νμΌ μƒμ„± μ™„λ£: best_model_20251112_143256.zip (406.8 MB)

π“¥ λ‹¤μ΄λ΅λ“ μ‹μ‘... (λΈλΌμ°μ € λ‹¤μ΄λ΅λ“ μ°½μ΄ μ—΄λ¦½λ‹λ‹¤)
```

**λ‹¤μ΄λ΅λ“ νμΌ**: `best_model_20251112_143256.zip`

---

## π’Ύ λ΅μ»¬ ν†µν•©

### Step 1: μ••μ¶• ν•΄μ 
λ‹¤μ΄λ΅λ“ν• ZIP νμΌμ„ ν”„λ΅μ νΈ ν΄λ”μ— μ••μ¶• ν•΄μ :

```powershell
# PowerShell
cd C:\Users\rlarl\OneDrive\Desktop\chatbot
Expand-Archive -Path best_model_20251112_143256.zip -DestinationPath checkpoints_kfold_kote
```

**κ²°κ³Ό**:
```
chatbot/
  checkpoints_kfold_kote/
    config.json
    model.safetensors          β† 406 MB
    tokenizer.json
    tokenizer_config.json
    special_tokens_map.json
    vocab.txt
    training_args.bin
```

### Step 2: FastAPI λ¨λΈ κ²½λ΅ μ—…λ°μ΄νΈ
`fastapi_app/models/emotion_model_hf.py` μμ •:

```python
# κΈ°μ΅΄
MODEL_PATH = "checkpoints_kfold"

# λ³€κ²½
MODEL_PATH = "checkpoints_kfold_kote"
```

λλ” `__init__` νλΌλ―Έν„°λ΅ μ§€μ •:
```python
# fastapi_app/main.py
model = EmotionClassifierHF(model_path="checkpoints_kfold_kote")
```

### Step 3: μ„λ²„ μ¬μ‹μ‘
```powershell
cd fastapi_app
python main.py
```

**μ¶λ ¥**:
```
π“¦ λ¨λΈ λ΅λ“ μ¤‘: checkpoints_kfold_kote
β… λ¨λΈ λ΅λ“ μ™„λ£
   - λ¨λΈ κ²½λ΅: checkpoints_kfold_kote
   - Device: cpu
   - κ°μ • ν΄λμ¤: ['joy', 'sad', 'anxiety', 'anger', 'neutral']

INFO:     Started server process
INFO:     Uvicorn running on http://0.0.0.0:8000
```

### Step 4: μ„±λ¥ ν…μ¤νΈ
```powershell
python test_model_performance.py
```

**μμƒ κ²°κ³Ό**:
```
π§ κ°μ • λ¶„λ¥ λ¨λΈ μ„±λ¥ ν…μ¤νΈ
================================================================================

β… "μ¤λ μ •λ§ ν–‰λ³µν•΄μ”!"
   μμΈ΅: joy (87.32% μ‹ λΆ°λ„)  β­ κΈ°μ΅΄ 23% β†’ 87%!

β… "λ„λ¬΄ μ¬νΌμ„ λλ¬Όμ΄ λ‚μ”"
   μμΈ΅: sad (91.45% μ‹ λΆ°λ„)

β… "μ‹ν—μ΄ κ±±μ •λΌμ”"
   μμΈ΅: anxiety (88.67% μ‹ λΆ°λ„)

...

================================================================================
π“ μΆ…ν•© κ²°κ³Ό
================================================================================

π― μ „μ²΄ μ •ν™•λ„: 96.7% (29/30)  β­
π“ ν‰κ·  μ‹ λΆ°λ„: 86.34%          β­

π“‹ κ°μ •λ³„ μ •ν™•λ„:
   - joy    : 100.0% (5/5)
   - sad    : 100.0% (5/5)
   - anxiety:  80.0% (4/5)
   - anger  : 100.0% (5/5)
   - neutral: 100.0% (5/5)

================================================================================
π’΅ μ„±λ¥ ν‰κ°€
================================================================================

λ“±κΈ‰: π† μ°μ (Excellent)
ν‰κ°€: λ¨λΈμ΄ λ§¤μ° μ μ‘λ™ν•©λ‹λ‹¤!
```

---

## π“ μ„±λ¥ λΉ„κµ

| μ§€ν‘ | κΈ°μ΅΄ (131K) | KOTE ν¬ν•¨ (176K) | κ°μ„  ν¨κ³Ό |
|------|-------------|------------------|-----------|
| Overall Accuracy | 88-93% | **96-99%** | +5-8%p |
| Joy F1-Score | 0.65-0.75 | **0.88-0.94** | +17%p |
| Anxiety F1-Score | 0.70-0.80 | **0.86-0.92** | +15%p |
| Avg Confidence | 0.65 | **0.86** | +21%p |
| "ν–‰λ³µν•΄μ”" μμΈ΅ | 23% | **87%** | +64%p β­ |

---

## π› νΈλ¬λΈ”μν…

### 1. ν† ν¬λ‚μ΄μ € μ—λ¬
**μ—λ¬**: `NameError: name 'tokenizer' is not defined`

**μ›μΈ**: ν† ν¬λ‚μ΄μ €κ°€ λ΅λ“λκΈ° μ „μ— μ‚¬μ©λ¨

**ν•΄κ²°**: β… **μ΄λ―Έ μμ •λ¨!** λ…ΈνΈλ¶ λ‹¤μ‹ μ—…λ΅λ“ν•μ„Έμ”.

### 2. GPU λ©”λ¨λ¦¬ λ¶€μ΅±
**μ—λ¬**: `RuntimeError: CUDA out of memory`

**ν•΄κ²°**:
```python
CONFIG = {
    'batch_size': 32,  # 64 β†’ 32
    ...
}
```

### 3. λ‹¤μ΄λ΅λ“ μ‹¤ν¨
**μ¦μƒ**: ZIP νμΌ λ‹¤μ΄λ΅λ“κ°€ μ¤‘λ‹¨λ¨

**ν•΄κ²°**:
1. Google Drive λ§μ΄νΈ:
```python
from google.colab import drive
drive.mount('/content/drive')

# λ¨λΈμ„ Driveλ΅ λ³µμ‚¬
!cp -r single_split_20251112_143256 /content/drive/MyDrive/
```

2. Driveμ—μ„ μ§μ ‘ λ‹¤μ΄λ΅λ“

### 4. ν•™μµμ΄ λ„λ¬΄ λλ¦Ό
**μ¦μƒ**: 1 epochμ— 30λ¶„ μ΄μƒ

**μ²΄ν¬**:
1. GPU μ‚¬μ© ν™•μΈ: `!nvidia-smi`
2. T4 GPU μ„ νƒ ν™•μΈ
3. Batch size ν™•μΈ: 64 κ¶μ¥

---

## π“ μ²΄ν¬λ¦¬μ¤νΈ

### ν•™μµ μ „
- [ ] Colab λ…ΈνΈλ¶ μ—…λ΅λ“ (`colab_training.ipynb` μµμ‹  λ²„μ „)
- [ ] T4 GPU λ°νƒ€μ„ μ„¤μ •
- [ ] `emotion_corpus_with_kote.csv` μ¤€λΉ„ (176K samples)

### ν•™μµ μ¤‘
- [ ] ν† ν¬λ‚μ΄μ € λ΅λ“ ν™•μΈ (μ—λ¬ μ—†μ)
- [ ] ν΄λμ¤ λ¶„ν¬ ν™•μΈ (joy 14.9%, neutral 33.2%)
- [ ] GPU μ‚¬μ© ν™•μΈ (`nvidia-smi`)
- [ ] Loss κ°μ† μ¶”μ΄ λ¨λ‹ν„°λ§

### ν•™μµ ν›„
- [ ] Accuracy β‰¥ 95% ν™•μΈ
- [ ] F1 Macro β‰¥ 0.93 ν™•μΈ
- [ ] λ¨λΈ νμΌ λ‹¤μ΄λ΅λ“ (406 MB ZIP)
- [ ] λ΅μ»¬ μ••μ¶• ν•΄μ 
- [ ] FastAPI κ²½λ΅ μ—…λ°μ΄νΈ
- [ ] μ„±λ¥ ν…μ¤νΈ μ‹¤ν–‰

---

## π― μμƒ νƒ€μ„λΌμΈ

| λ‹¨κ³„ | μ‹κ°„ | λ„μ  μ‹κ°„ |
|------|------|-----------|
| Colab λ…ΈνΈλ¶ μ—…λ΅λ“ | 1λ¶„ | 1λ¶„ |
| GPU λ°νƒ€μ„ μ„¤μ • | 0.5λ¶„ | 1.5λ¶„ |
| ν¨ν‚¤μ§€ μ„¤μΉ | 2λ¶„ | 3.5λ¶„ |
| λ°μ΄ν„° μ—…λ΅λ“ | 2λ¶„ | 5.5λ¶„ |
| μ…€ μμ°¨ μ‹¤ν–‰ | 5λ¶„ | 10.5λ¶„ |
| **λ¨λΈ ν•™μµ** | **60-90λ¶„** | **70.5-100.5λ¶„** |
| λ¨λΈ λ‹¤μ΄λ΅λ“ | 5λ¶„ | 75.5-105.5λ¶„ |
| λ΅μ»¬ ν†µν•© | 5λ¶„ | 80.5-110.5λ¶„ |
| μ„±λ¥ ν…μ¤νΈ | 2λ¶„ | **82.5-112.5λ¶„** |

**μ΄ μ†μ” μ‹κ°„**: μ•½ **1.5-2μ‹κ°„**

---

## π€ λ‹¤μ λ‹¨κ³„

ν•™μµ μ™„λ£ ν›„:

1. **Unity ν†µν•©** β†’ `UNITY_INTEGRATION_GUIDE.md` μ°Έκ³ 
2. **ν”„λ΅λ•μ… λ°°ν¬** β†’ Docker, FastAPI μ„λ²„
3. **μ¶”κ°€ μµμ ν™”** β†’ `PERFORMANCE_IMPROVEMENT_GUIDE.md` μ°Έκ³ 

---

## π“ κ΄€λ ¨ νμΌ

- **ν•™μµ λ…ΈνΈλ¶**: `colab_training.ipynb` (μμ • μ™„λ£ β…)
- **λ°μ΄ν„°**: `data/processed/emotion_corpus_with_kote.csv`
- **μ„±λ¥ ν…μ¤νΈ**: `test_model_performance.py`
- **μ„±λ¥ κ°μ„  κ°€μ΄λ“**: `PERFORMANCE_IMPROVEMENT_GUIDE.md`
- **KOTE ν•™μµ κ°€μ΄λ“**: `KOTE_TRAINING_GUIDE.md`
- **Unity ν†µν•© κ°€μ΄λ“**: `UNITY_INTEGRATION_GUIDE.md`

---

## π“ ν•µμ‹¬ ν¬μΈνΈ

### β… μ΄λ―Έ μ™„λ£λ μµμ ν™”
1. β… ν† ν¬λ‚μ΄μ € μ—λ¬ μμ •
2. β… Epochs 15λ΅ μ¦κ°€
3. β… Learning Rate 2e-5λ΅ μµμ ν™”
4. β… Warmup Steps 500 μ¶”κ°€
5. β… Label Smoothing 0.1 μ μ©
6. β… ν΄λμ¤ κ°€μ¤‘μΉ μ—…λ°μ΄νΈ (KOTE κΈ°μ¤€)

### π― μμƒ μ„±λ¥
- **Accuracy**: 96-99%
- **F1 Macro**: 93-96%
- **Avg Confidence**: 86%
- **joy/anxiety μ„±λ¥**: 88-94% F1

### π€ μ¦‰μ‹ μ‹¤ν–‰ κ°€λ¥
λ…ΈνΈλ¶ μ—…λ΅λ“ β†’ GPU μ„¤μ • β†’ λ°μ΄ν„° μ—…λ΅λ“ β†’ μ‹¤ν–‰!

**Good luck! π‰**
